import { ChatBarButton } from "@api/ChatButtons";
import { Margins } from "@utils/margins";
import { classes } from "@utils/misc";
import { openModal } from "@utils/modal";
import { Alerts, Forms } from "@webpack/common";

import { UwuifyModal } from "./UwuifyModal";
import { settings } from "./settings";
import { cl } from "./utils";

export function KittyIcon({ height = 24, width = 24, className }: { height?: number; width?: number; className?: string; }) {
    return (
        <svg
            viewBox="0 0 20 20"
            height={height}
            width={width}
            className={classes(cl("icon"), className)}
        >
            <path fill="currentColor" d="M2.56849 2.04898C2.39683 2.12582 2.3052 2.24551 2.18271 2.55277C2.09855 2.76398 2.09365 2.81885 2.09791 3.50535C2.10228 4.21781 2.15323 4.73063 2.35387 6.08292C2.44125 6.67173 2.66946 7.78831 2.75747 8.05776C2.83409 8.29224 2.83424 8.29897 2.76681 8.54339C2.72923 8.6797 2.69072 8.83749 2.68119 8.89397L2.66393 8.9967L3.19118 9.00137C3.48113 9.00395 3.73101 9.00914 3.7464 9.01295C3.76179 9.01676 3.86262 9.03305 3.97039 9.04915C4.16016 9.07747 4.17432 9.07313 4.41866 8.91224C4.74624 8.69655 4.89451 8.62296 5.3247 8.46266C5.81462 8.28006 6.21142 8.21222 6.78917 8.21222C7.74889 8.21222 8.72646 8.51522 9.4397 9.0338C9.67363 9.20388 9.69683 9.21259 9.83194 9.18124C10.0278 9.13578 10.4527 9.13765 10.5759 9.18449C10.6642 9.21808 10.7022 9.20515 10.8783 9.08176C11.7724 8.45545 12.6913 8.18073 13.7481 8.22392C14.5821 8.25802 15.2278 8.4491 15.9162 8.86558L16.2575 9.07209L16.6093 9.03507C16.8028 9.01467 17.1335 8.99771 17.344 8.99734C17.787 8.99659 17.767 9.02323 17.6514 8.58833C17.5777 8.31152 17.5777 8.30984 17.6519 8.02798C17.8423 7.30436 18.0601 6.10896 18.1731 5.1677C18.4497 2.8617 18.2941 2.01024 17.5962 2.01181C17.0612 2.01297 15.8352 2.47017 14.7816 3.06152C13.9852 3.50841 12.8909 4.2267 12.3545 4.6545C12.2707 4.72129 12.2592 4.7214 12.0052 4.65689C11.4912 4.52633 10.9293 4.46548 10.2184 4.46331C9.52349 4.46122 9.21437 4.49174 8.51107 4.63179L8.12992 4.70773L7.80855 4.47074C6.24781 3.32003 4.71351 2.49072 3.51091 2.14786C2.93473 1.98361 2.75631 1.96489 2.56849 2.04898ZM3.90554 4.42771C3.90576 4.44433 3.93796 4.64284 3.97711 4.86885C4.01622 5.09485 4.10226 5.64959 4.16826 6.1016C4.23427 6.55361 4.29442 6.93031 4.30192 6.93875C4.30943 6.94716 4.4964 6.86841 4.7174 6.76378C5.08726 6.58865 5.73248 6.36003 6.27306 6.21255L6.49301 6.15256L6.16099 5.9094C5.88751 5.70906 4.11257 4.51572 3.95186 4.42409C3.9262 4.40948 3.90535 4.41109 3.90554 4.42771ZM15.6695 4.9356C14.7766 5.53054 14.0037 6.07011 13.9729 6.11994C13.9617 6.13795 14.1 6.19619 14.2802 6.24931C14.7948 6.40109 15.439 6.63744 15.7714 6.79646C15.9389 6.87656 16.0842 6.94212 16.0944 6.94212C16.1046 6.94212 16.1312 6.83703 16.1534 6.70864C16.2315 6.25846 16.4937 4.42629 16.4818 4.41437C16.4752 4.40776 16.1096 4.64232 15.6695 4.9356ZM6.10918 8.70039C5.54372 8.78512 4.95752 9.02495 4.5289 9.34696L4.31208 9.50979L3.53896 9.49474C3.1137 9.48648 2.71212 9.47539 2.64649 9.47008C2.55295 9.46254 2.52317 9.47692 2.50857 9.53676C2.49011 9.61226 2.4779 10.0281 2.48298 10.4062L2.48563 10.6015L3.27945 10.6116L4.07327 10.6217L4.10069 10.87C4.21163 11.8744 5.02783 12.833 6.0088 13.1109C6.26619 13.1838 6.39454 13.1968 6.81895 13.1927C7.24596 13.1887 7.37477 13.1727 7.65946 13.0889C8.10803 12.9568 8.45783 12.7435 8.79882 12.3944C9.136 12.0493 9.36025 11.6843 9.51744 11.2249C9.61957 10.9265 9.6347 10.8311 9.63687 10.4723C9.64001 9.94985 9.56769 9.76788 9.23197 9.45387C8.68776 8.94478 7.78105 8.65478 6.76568 8.66506C6.51759 8.66756 6.22218 8.68347 6.10918 8.70039ZM12.783 8.71814C11.9589 8.87272 11.2501 9.24497 10.9498 9.68111C10.646 10.1221 10.6577 10.8193 10.9805 11.518C11.1422 11.8681 11.2886 12.0797 11.5896 12.3989C11.8966 12.7243 12.1602 12.8983 12.5541 13.0357C13.3872 13.3263 14.309 13.2514 15.0186 12.8355C15.6732 12.4519 16.2166 11.6273 16.2961 10.8968L16.3261 10.6217L17.1199 10.6116L17.9137 10.6015L17.9132 10.0886C17.9128 9.80655 17.8983 9.55327 17.8809 9.52578C17.8469 9.4721 17.1099 9.46041 16.4382 9.50288L16.102 9.52417L15.8405 9.33179C15.5124 9.09043 15.0697 8.87597 14.6824 8.77096C14.2877 8.66386 13.2293 8.63442 12.783 8.71814ZM6.3765 9.37079C5.84656 9.44472 5.2996 9.68936 5.00459 9.98436C4.82726 10.1617 4.80601 10.2008 4.78176 10.3948C4.74545 10.6855 4.84045 11.1471 5.00605 11.4843C5.40169 12.2899 6.31318 12.6761 7.24372 12.4324C7.93668 12.2509 8.36415 11.9193 8.64454 11.3458C8.86087 10.9032 8.94619 10.2751 8.81533 10.0883C8.7392 9.97958 8.35888 9.72253 8.11427 9.61446C7.64739 9.40818 6.87991 9.30056 6.3765 9.37079ZM13.3376 9.37352C12.9829 9.39432 12.5546 9.49052 12.2446 9.6191C11.9893 9.72493 11.6419 10.0004 11.5592 10.1626C11.4882 10.3017 11.4847 10.3399 11.5208 10.5825C11.6619 11.5312 12.1748 12.1576 13.0086 12.3991C13.394 12.5108 13.7768 12.5301 14.1145 12.455C15.0442 12.2482 15.603 11.5364 15.6123 10.547C15.6158 10.1807 15.5575 10.0663 15.2625 9.86038C14.7029 9.46989 14.1366 9.32663 13.3376 9.37352ZM10.0903 11.0734C9.89836 11.6156 9.57777 12.2024 9.31363 12.4951L9.24119 12.5753L9.38961 12.6004C9.60157 12.6362 9.95709 12.8154 10.0837 12.9501L10.1919 13.0653L10.3585 12.9187C10.4501 12.838 10.6571 12.718 10.8186 12.652L11.112 12.532L10.982 12.3613C10.6889 11.9766 10.4544 11.5228 10.2588 10.9613L10.1949 10.778L10.0903 11.0734ZM2.64936 11.154C2.66005 11.19 2.70454 11.3623 2.74824 11.5369C2.85673 11.97 3.19861 12.7047 3.52365 13.2032C3.67184 13.4305 3.7931 13.6276 3.7931 13.6413C3.7931 13.655 3.46447 13.6662 3.06278 13.6662C2.49654 13.6662 2.30886 13.6784 2.22731 13.7206C2.11547 13.7785 2 13.9785 2 14.1145C2 14.2685 2.11801 14.4522 2.26515 14.5273C2.39754 14.5948 2.49142 14.6001 3.55379 14.6001C4.63271 14.6001 4.98849 14.6281 4.98849 14.713C4.98849 14.7432 4.71859 14.9363 4.67634 14.9363C4.59285 14.9363 2.93387 15.6286 2.83274 15.7056C2.66703 15.8319 2.63898 16.0018 2.74701 16.2249C2.88418 16.5083 3.13623 16.5774 3.48181 16.4264C3.70837 16.3274 4.74228 15.9211 5.37341 15.6829L5.85168 15.5025L5.97604 15.6117C6.0444 15.6717 6.12367 15.7208 6.15214 15.7208C6.19256 15.7208 6.42278 15.5876 6.51677 15.5098C6.52518 15.5028 6.50254 15.4645 6.46642 15.4245C6.38748 15.3373 6.41004 15.2895 6.54632 15.2553C6.60224 15.2413 6.88163 15.129 7.16718 15.0059C7.45269 14.8827 7.72692 14.7665 7.77653 14.7476L7.86675 14.7134L7.77496 14.5727C7.66798 14.4087 7.5462 14.0584 7.5094 13.8088L7.48362 13.6339L6.95518 13.6372C6.59096 13.6394 6.33963 13.6213 6.14653 13.5787C5.81466 13.5056 5.32761 13.2799 5.00489 13.0496C4.51396 12.6993 4.00337 12.037 3.79556 11.4809C3.6306 11.0394 3.71323 11.0886 3.13764 11.0886C2.67174 11.0886 2.63162 11.094 2.64936 11.154ZM16.6837 11.2613C16.5621 11.7442 16.2505 12.2387 15.7684 12.7136C15.0754 13.3963 14.2114 13.717 13.2535 13.6471C13.0635 13.6332 12.908 13.6326 12.908 13.6456C12.908 13.7969 12.7629 14.2964 12.6653 14.481C12.5408 14.7166 12.5407 14.7167 12.6216 14.7522C12.6661 14.7718 12.9798 14.903 13.3186 15.0439L13.9347 15.3L13.9608 15.4526C13.9924 15.6379 14.053 15.7584 14.114 15.7576C14.139 15.7573 14.2431 15.7002 14.3453 15.6307L14.5312 15.5044L14.7936 15.5978C14.9379 15.6492 15.5206 15.8745 16.0885 16.0983C16.6564 16.3221 17.1657 16.5053 17.2204 16.5053C17.3522 16.5053 17.5154 16.4178 17.6116 16.2955C17.7475 16.1227 17.6999 15.7851 17.5233 15.6694C17.4382 15.6136 16.5281 15.2396 15.8311 14.974C15.6 14.8859 15.4109 14.8025 15.4109 14.7886C15.4109 14.7747 15.4762 14.7266 15.556 14.6817C15.6964 14.6029 15.7388 14.6001 16.8273 14.6001C18.0209 14.6001 18.1137 14.5884 18.2647 14.4189C18.3724 14.298 18.3846 14.0131 18.2886 13.8601C18.1604 13.6558 18.0404 13.6289 17.26 13.6289H16.5666L16.7216 13.419C17.1712 12.8104 17.626 11.8183 17.7089 11.2653L17.7354 11.0886H17.2313H16.7272L16.6837 11.2613ZM10.0763 14.3118C9.95978 14.5174 9.63866 14.8546 9.45046 14.9691C9.14026 15.1577 8.73535 15.1821 8.3362 15.036L8.07904 14.942L7.71983 15.1817C7.52225 15.3136 6.77352 15.8124 6.05598 16.2902C5.33845 16.7681 4.71647 17.2065 4.6738 17.2645C4.56995 17.4058 4.56854 17.6822 4.67097 17.8196C4.80683 18.0017 5.04087 18.0517 5.25047 17.9432C5.31035 17.9123 5.75556 17.6197 6.23985 17.2929L7.12037 16.6989L7.70421 16.9947C8.02533 17.1573 8.41708 17.3311 8.57476 17.381C10.0308 17.8409 11.6413 17.6537 12.9624 16.8709C13.1053 16.7862 13.2398 16.7174 13.2612 16.7179C13.2827 16.7184 13.6869 16.9794 14.1594 17.2979C15.1483 17.9644 15.2101 17.9995 15.3941 17.9995C15.5684 17.9995 15.7669 17.8137 15.804 17.6156C15.8549 17.3444 15.7688 17.2528 14.9252 16.6805C14.2725 16.2378 13.3469 15.6256 12.5026 15.0781L12.2891 14.9397L12.0894 15.0386C11.9239 15.1205 11.8375 15.1377 11.5863 15.1387C11.0761 15.1408 10.7288 14.9273 10.3702 14.391L10.1868 14.1169L10.0763 14.3118Z" />
        </svg>
    );
}

export const KittyChatBarIcon: ChatBarButton = ({ isMainChat }) => {
    const { autoUwuify, showChatBarButton } = settings.use(["autoUwuify", "showChatBarButton"]);

    if (!isMainChat || !showChatBarButton) return null;

    const toggle = () => {
        const newState = !autoUwuify;
        settings.store.autoUwuify = newState;
        if (newState && settings.store.showAutoUwuifyAlert !== false)
            Alerts.show({
                title: "Vencord UwUify Enabled",
                body: <>
                    <Forms.FormText>
                        You just enabled auto UwUify (by right clicking the Kitty icon). Any message you send will automatically be UwUified before being sent.
                    </Forms.FormText>
                    <Forms.FormText className={Margins.top16}>
                        If this was an accident, disable it again, or it will change your message content before sending.
                    </Forms.FormText>
                </>,
                cancelText: "Disable Auto-UwUify",
                confirmText: "Got it",
                secondaryConfirmText: "Don't show again",
                onConfirmSecondary: () => settings.store.showAutoUwuifyAlert = false,
                onCancel: () => settings.store.autoUwuify = false
            });
    };

    return (
        <ChatBarButton
            tooltip="UwUify"
            onClick={e => {
                if (e.shiftKey) return toggle();

                openModal(props => (
                    <UwuifyModal rootProps={props} />
                ));
            }}
            onContextMenu={() => toggle()}
            buttonProps={{
                "aria-haspopup": "dialog"
            }}
        >
            <KittyIcon className={cl({ "auto-uwuify": autoUwuify, "chat-button": true })} />
        </ChatBarButton>
    );
};
